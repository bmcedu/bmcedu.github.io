<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ساحة الإدارة - نظام إدارة الأعذار | كليات البترجي الطبية</title>
    <link rel="icon" type="image/png" href="favicon.png">

    <!-- Bootstrap 5 RTL CSS -->
    <link rel="stylesheet" href="lib/bootstrap/css/bootstrap.rtl.min.css">

    <!-- Hugeicons -->
    <link rel="stylesheet" href="https://sets.hugeicons.com/sy6ko98f5o.css" crossorigin="anonymous">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/custom.css">

    <!-- SheetJS for Excel Export -->
    <script src="lib/sheetjs/xlsx.full.min.js"></script>

    <!-- Tempus Dominus Styles -->

    <link rel="stylesheet" href="lib/tempus-dominus/tempus-dominus.min.css">


</head>

<body class="bg-body-tertiary">
    <!-- Navbar -->
    <nav class="navbar navbar-light bg-white shadow-sm">
        <div class="container-fluid px-0">
            <!-- Top Row: Brand + Logout -->
            <div class="d-flex justify-content-between align-items-center w-100 py-1 px-4">
                <a class="navbar-brand d-flex align-items-center gap-4 mb-0" href="#">
                    <img src="images/logo.svg" alt="BMC Logo" height="40" class="d-inline-block align-text-top ms-2">
                    <span class="fw-bold text-primary">نظام إدارة الأعذار - ساحة الإدارة</span>
                </a>
                <button id="logoutBtn" class="btn btn-outline-danger btn-sm d-flex align-items-center gap-2">
                    <i class="hgi hgi-stroke hgi-standard hgi-logout-02"></i> تسجيل خروج
                </button>
            </div>
            <!-- Bottom Row: Navigation -->
            <div class="w-100 border-top pt-2 px-4">
                <ul class="navbar-nav flex-row gap-2">
                    <li class="nav-item">
                        <a class="btn btn-primary d-flex align-items-center gap-2 px-3" href="#" id="navDashboard">
                            <i class="hgi hgi-stroke hgi-standard hgi-home-01"></i>
                            الرئيسية
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="btn btn-outline-secondary d-flex align-items-center gap-2 px-3" href="#"
                            id="navSettings">
                            <i class="hgi hgi-stroke hgi-standard hgi-settings-02"></i>
                            الإعدادات
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Content -->
    <div class="container-fluid p-4">
        <!-- Welcome Banner -->
        <div
            class="welcome-banner bg-white rounded border p-4 mb-3 d-flex align-items-center position-relative overflow-hidden">


            <div class="row align-items-center w-100 position-relative z-1">
                <div class="col-12 text-center">
                    <h4 class="fw-medium mb-2" id="dashboardTitle">أهلأ وسهلاً بك،</h4>
                    <p class="text-muted mb-0">
                        هنا يمكنك إدارة ومراجعة أعذار جميع الطلاب
                    </p>
                </div>
            </div>
        </div>

        <!-- Content Row -->
        <div class="row g-3">
            <!-- Column 2 (Data Table) -->
            <div class="col-12">
                <div class="card shadow-sm border sticky-wrapper table-container">
                    <div class="card-body p-0">
                        <!-- Row 1: Title (No Add Button for Admin) -->
                        <div class="d-flex justify-content-between align-items-center p-3 border-bottom">
                            <h5 class="mb-0">جميع أعذار الطلاب</h5>
                            <button class="btn btn-outline-secondary d-flex align-items-center gap-2" type="button"
                                data-bs-toggle="collapse" data-bs-target="#filterSection">
                                <i class="hgi hgi-stroke hgi-standard hgi-filter"></i> تصفية
                            </button>
                        </div>

                        <!-- Filter Section (Collapsible) -->
                        <div class="collapse border-bottom bg-light bg-opacity-50" id="filterSection">
                            <div class="p-3">
                                <div class="row g-3">
                                    <!-- ROW 1 -->
                                    <!-- 1. Student Number (Custom Searchable Select) -->
                                    <div class="col-md-3">
                                        <label class="form-label small text-muted">الرقم الجامعي</label>
                                        <div class="searchable-select position-relative">
                                            <input type="text" class="form-control ps-5 pe-5" id="filterStudentIdInput"
                                                placeholder="بحث برقم الطالب..." autocomplete="off">
                                            <!-- Icons -->
                                            <i class="hgi hgi-stroke hgi-standard hgi-search-01 position-absolute top-50 start-0 translate-middle-y ms-3 text-muted"
                                                style="pointer-events: none;"></i>
                                            <i class="hgi hgi-stroke hgi-standard hgi-arrow-down-01 position-absolute top-50 end-0 translate-middle-y me-3 text-muted"
                                                style="pointer-events: none;"></i>

                                            <input type="hidden" id="filterStudentId">
                                            <div id="studentIdDropdownList" class="dropdown-menu w-100 p-0 shadow-sm"
                                                style="max-height: 200px; overflow-y: auto;">
                                                <!-- Options populated dynamically -->
                                            </div>
                                        </div>
                                    </div>
                                    <!-- 2. Student Name (Custom Searchable Select) -->
                                    <div class="col-md-3">
                                        <label class="form-label small text-muted">اسم الطالب</label>
                                        <div class="searchable-select position-relative">
                                            <input type="text" class="form-control ps-5 pe-5"
                                                id="filterStudentNameInput" placeholder="بحث أو اختر اسم الطالب..."
                                                autocomplete="off">
                                            <!-- Icons -->
                                            <i class="hgi hgi-stroke hgi-standard hgi-search-01 position-absolute top-50 start-0 translate-middle-y ms-3 text-muted"
                                                style="pointer-events: none;"></i>
                                            <i class="hgi hgi-stroke hgi-standard hgi-arrow-down-01 position-absolute top-50 end-0 translate-middle-y me-3 text-muted"
                                                style="pointer-events: none;"></i>

                                            <input type="hidden" id="filterStudentName">
                                            <div id="studentNameDropdownList" class="dropdown-menu w-100 p-0 shadow-sm"
                                                style="max-height: 200px; overflow-y: auto;">
                                                <!-- Options populated dynamically -->
                                            </div>
                                        </div>
                                    </div>
                                    <!-- 3. Date Range (Tempus Dominus) -->
                                    <div class="col-md-3">
                                        <label class="form-label small text-muted">تاريخ التقديم</label>
                                        <div class="input-group" id="tempusDominusWrapper"
                                            data-td-target-input="nearest" data-td-target-toggle="nearest">
                                            <input id="filterDateRange" type="text" class="form-control"
                                                data-td-target="#tempusDominusWrapper" placeholder="اختر الفترة..." />
                                            <span class="input-group-text" data-td-target="#tempusDominusWrapper"
                                                data-td-toggle="datetimepicker">
                                                <i class="hgi hgi-stroke hgi-standard hgi-calendar-03"></i>
                                            </span>
                                        </div>
                                    </div>
                                    <!-- 4. Type (Custom Static Select) -->
                                    <div class="col-md-3">
                                        <label class="form-label small text-muted">نوع العذر</label>
                                        <div class="searchable-select position-relative">
                                            <input type="text" class="form-control pe-5" id="filterTypeInput"
                                                placeholder="الكل" autocomplete="off"
                                                style="cursor: pointer; background-color: #fff;">
                                            <!-- Icon -->
                                            <i class="hgi hgi-stroke hgi-standard hgi-arrow-down-01 position-absolute top-50 end-0 translate-middle-y me-3 text-muted"
                                                style="pointer-events: none;"></i>

                                            <input type="hidden" id="filterType">
                                            <div id="typeDropdownList" class="dropdown-menu w-100 p-0 shadow-sm">
                                                <div class="dropdown-item p-2 cursor-pointer" data-value="">الكل</div>
                                                <div class="dropdown-item p-2 cursor-pointer" data-value="health">عذر
                                                    صحي
                                                </div>
                                                <div class="dropdown-item p-2 cursor-pointer" data-value="death">حالة
                                                    وفاة
                                                </div>
                                                <div class="dropdown-item p-2 cursor-pointer" data-value="scientific">
                                                    مهمة
                                                    علمية</div>
                                                <div class="dropdown-item p-2 cursor-pointer" data-value="other">أخرى
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- ROW 2 -->
                                    <!-- 4. Initial Classification Filter -->
                                    <div class="col-md-3">
                                        <label class="form-label small text-muted">التصنيف المبدئي</label>
                                        <div class="searchable-select position-relative">
                                            <input type="text" class="form-control pe-5" id="filterStatusInput"
                                                placeholder="اختيار التصنيف..." autocomplete="off"
                                                style="cursor: pointer; background-color: #fff;">
                                            <!-- Icon -->
                                            <i class="hgi hgi-stroke hgi-standard hgi-arrow-down-01 position-absolute top-50 end-0 translate-middle-y me-3 text-muted"
                                                style="pointer-events: none;"></i>

                                            <input type="hidden" id="filterStatus">
                                            <div id="statusDropdownList" class="dropdown-menu w-100 p-0 shadow-sm">
                                                <div class="dropdown-item p-2 cursor-pointer" data-value="">الكل</div>
                                                <div class="dropdown-item p-2 cursor-pointer" data-value="pending">قيد
                                                    المراجعة</div>
                                                <div class="dropdown-item p-2 cursor-pointer" data-value="approved">
                                                    مقبول
                                                </div>
                                                <div class="dropdown-item p-2 cursor-pointer" data-value="rejected">
                                                    مرفوض
                                                </div>
                                                <div class="dropdown-item p-2 cursor-pointer" data-value="mismatch">غير
                                                    مطابق</div>
                                                <div class="dropdown-item p-2 cursor-pointer" data-value="late">متأخر
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- 5. Employee Decision Filter -->
                                    <div class="col-md-3">
                                        <label class="form-label small text-muted">مراجعة الموظف</label>
                                        <div class="searchable-select position-relative">
                                            <input type="text" class="form-control pe-5"
                                                id="filterEmployeeDecisionInput" placeholder="اختيار القرار..."
                                                autocomplete="off" style="cursor: pointer; background-color: #fff;">
                                            <i class="hgi hgi-stroke hgi-standard hgi-arrow-down-01 position-absolute top-50 end-0 translate-middle-y me-3 text-muted"
                                                style="pointer-events: none;"></i>
                                            <input type="hidden" id="filterEmployeeDecision">
                                            <div id="employeeDecisionDropdownList"
                                                class="dropdown-menu w-100 p-0 shadow-sm">
                                                <div class="dropdown-item p-2 cursor-pointer" data-value="">الكل</div>
                                                <div class="dropdown-item p-2 cursor-pointer" data-value="pending">قيد
                                                    المراجعة</div>
                                                <div class="dropdown-item p-2 cursor-pointer" data-value="approved">
                                                    مقبول</div>
                                                <div class="dropdown-item p-2 cursor-pointer" data-value="rejected">
                                                    مرفوض</div>
                                                <div class="dropdown-item p-2 cursor-pointer" data-value="committee">
                                                    يحتاج قرار لجنة</div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- 6. Committee Decision Filter -->
                                    <div class="col-md-3">
                                        <label class="form-label small text-muted">قرار اللجنة</label>
                                        <div class="searchable-select position-relative">
                                            <input type="text" class="form-control pe-5"
                                                id="filterCommitteeDecisionInput" placeholder="اختيار القرار..."
                                                autocomplete="off" style="cursor: pointer; background-color: #fff;">
                                            <i class="hgi hgi-stroke hgi-standard hgi-arrow-down-01 position-absolute top-50 end-0 translate-middle-y me-3 text-muted"
                                                style="pointer-events: none;"></i>
                                            <input type="hidden" id="filterCommitteeDecision">
                                            <div id="committeeDecisionDropdownList"
                                                class="dropdown-menu w-100 p-0 shadow-sm">
                                                <div class="dropdown-item p-2 cursor-pointer" data-value="">الكل</div>
                                                <div class="dropdown-item p-2 cursor-pointer" data-value="pending">قيد
                                                    المراجعة</div>
                                                <div class="dropdown-item p-2 cursor-pointer" data-value="approved">
                                                    مقبول</div>
                                                <div class="dropdown-item p-2 cursor-pointer" data-value="rejected">
                                                    مرفوض</div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- ROW 3 -->
                                    <!-- 7. Course (Custom Searchable Select) -->
                                    <div class="col-md-3">
                                        <label class="form-label small text-muted">المادة</label>
                                        <div class="searchable-select position-relative">
                                            <input type="text" class="form-control ps-5 pe-5" id="filterCourseInput"
                                                placeholder="بحث أو اختر المادة..." autocomplete="off">
                                            <!-- Icons -->
                                            <i class="hgi hgi-stroke hgi-standard hgi-search-01 position-absolute top-50 start-0 translate-middle-y ms-3 text-muted"
                                                style="pointer-events: none;"></i>
                                            <i class="hgi hgi-stroke hgi-standard hgi-arrow-down-01 position-absolute top-50 end-0 translate-middle-y me-3 text-muted"
                                                style="pointer-events: none;"></i>

                                            <input type="hidden" id="filterCourse">
                                            <div id="courseDropdownList" class="dropdown-menu w-100 p-0 shadow-sm"
                                                style="max-height: 200px; overflow-y: auto;">
                                                <!-- Options populated dynamically -->
                                            </div>
                                        </div>
                                    </div>
                                    <!-- Actions -->
                                    <div class="col-12 d-flex justify-content-end gap-3">
                                        <button
                                            class="btn btn-outline-secondary px-4 d-inline-flex align-items-center gap-2"
                                            id="btnCollectEmails">
                                            <i class="hgi hgi-stroke hgi-standard hgi-mail-01"></i> نسخ الإيميلات
                                        </button>
                                        <button
                                            class="btn btn-outline-success px-4 d-inline-flex align-items-center gap-2"
                                            id="btnExportExcel">
                                            <i class="hgi hgi-stroke hgi-standard hgi-file-export"></i> تصدير إكسل
                                        </button>
                                        <button class="btn btn-primary px-4 d-inline-flex align-items-center gap-2"
                                            id="btnResetFilters">
                                            <i class="hgi hgi-stroke hgi-standard hgi-refresh"></i> إعادة تعيين
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Row 2: Table -->
                    <div class="table-responsive">
                        <table class="table table-hover align-middle m-0">
                            <thead>
                                <tr>
                                    <th scope="col" class="ps-4 fw-medium">رقم العذر</th>
                                    <th scope="col" class="ps-4 fw-medium">الطالب</th>
                                    <th scope="col" class="ps-4 fw-medium">نوع العذر</th>
                                    <th scope="col" class="ps-4 fw-medium">تاريخ تقديم العذر</th>
                                    <th scope="col" class="ps-4 fw-medium">تاريخ العذر</th>
                                    <th scope="col" class="ps-4 fw-medium">التصنيف المبدئي</th>
                                    <th scope="col" class="ps-4 fw-medium">مراجعة الموظف</th>
                                    <th scope="col" class="ps-4 fw-medium">قرار اللجنة</th>
                                    <th scope="col" class="ps-4 fw-medium">إجراءات</th>
                                </tr>
                            </thead>
                            <tbody id="requestsTableBody">
                                <!-- Requests will be loaded here -->
                            </tbody>
                        </table>
                    </div>

                    <!-- Row 3: Pagination -->
                    <div class="d-flex justify-content-between align-items-center px-3 py-2">
                        <span class="text-muted" id="requestsCountLabel">عرض 0 أعذار</span>
                        <nav aria-label="Page navigation">
                            <ul id="pagination" class="pagination justify-content-end mb-0 gap-1">
                                <li class="page-item disabled">
                                    <a class="page-link" href="#" aria-label="Previous">
                                        <i class="hgi hgi-stroke hgi-standard hgi-arrow-right-double"></i>
                                    </a>
                                </li>
                                <li class="page-item active"><a class="page-link" href="#">1</a></li>
                                <li class="page-item">
                                    <a class="page-link" href="#" aria-label="Next">
                                        <i class="hgi hgi-stroke hgi-standard hgi-arrow-left-double"></i>
                                    </a>
                                </li>
                            </ul>
                        </nav>
                    </div>
                </div> <!-- Close card-body -->
            </div> <!-- Close card -->
        </div>
    </div>

    <!-- Request Details Modal -->
    <div class="modal fade" id="requestDetailsModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title fw-bold">عرض تفاصيل العذر</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- Nav Tabs -->
                    <ul class="nav nav-pills nav-fill mb-3 gap-1 border-0" id="detailsTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active fw-medium" id="details-tab" data-bs-toggle="tab"
                                data-bs-target="#details-pane" type="button" role="tab" aria-controls="details-pane"
                                aria-selected="true">تفاصيل العذر</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link fw-medium" id="decision-tab" data-bs-toggle="tab"
                                data-bs-target="#decision-pane" type="button" role="tab" aria-controls="decision-pane"
                                aria-selected="false">قرار اللجنة</button>
                        </li>
                    </ul>

                    <div class="tab-content" id="detailsTabsContent">
                        <!-- Tab 2: Committee Decision (Was 1) -->
                        <div class="tab-pane fade" id="decision-pane" role="tabpanel" aria-labelledby="decision-tab">

                            <!-- Status Summary Row (Badges Only) -->
                            <div class="row g-2 mb-4 pb-3 border-bottom">
                                <!-- Initial Classification (Status) -->
                                <div class="col-md-4" id="detailStatusColumn">
                                    <div id="detailStatus"
                                        class="alert mb-0 h-100 d-flex align-items-center justify-content-center"></div>
                                </div>

                                <!-- Employee Review Badge -->
                                <div class="col-md-4" id="employeeDecisionBadgeColumn" style="display: none;">
                                    <div id="employeeDecisionBadgeContainer" class="h-100"></div>
                                </div>

                                <!-- Committee Decision Badge -->
                                <div class="col-md-4" id="committeeDecisionBadgeColumn" style="display: none;">
                                    <div id="committeeDecisionBadgeContainer" class="h-100"></div>
                                </div>
                            </div>

                            <!-- Editable Action Area -->
                            <div id="decisionEditableArea">
                                <!-- 1. Employee Decision Form -->
                                <div id="employeeDecisionInputSection" class="mb-4" style="display: none;">
                                    <label class="fw-bold mb-2">مراجعة الموظف:</label>
                                    <select class="form-select" id="detailEmployeeDecision">
                                        <option value="" selected>اختر القرار...</option>
                                        <option value="approved">مقبول</option>
                                        <option value="rejected">مرفوض</option>
                                        <option value="committee">يحتاج قرار لجنة</option>
                                    </select>
                                </div>

                                <!-- 2. Committee Decision Form -->
                                <div id="committeeDecisionInputSection" style="display: none;">
                                    <div class="mb-4">
                                        <label class="fw-bold mb-2">قرار اللجنة:</label>
                                        <select class="form-select" id="detailCommitteeDecision">
                                            <option value="" selected>اختر القرار...</option>
                                            <option value="approved">مقبول</option>
                                            <option value="rejected">مرفوض</option>
                                        </select>
                                    </div>

                                    <div class="mb-4">
                                        <label class="fw-bold mb-2">تعليق اللجنة:</label>
                                        <textarea class="form-control" id="detailCommitteeComment" rows="3"
                                            placeholder="أضف تعليق اللجنة هنا..."></textarea>
                                    </div>
                                </div>

                                <!-- 3. Final Comment Display (Read Only) -->
                                <div id="finalCommentSection" class="mb-3" style="display: none;">
                                    <label class="fw-bold mb-2">تعليق اللجنة:</label>
                                    <textarea class="form-control" id="committeeCommentDisplay" rows="3"
                                        disabled></textarea>
                                </div>

                                <div class="mb-3" id="committeeSignaturesContainer" style="display: none;">
                                    <label class="fw-bold mb-2">توقيعات اللجنة:</label>
                                    <div id="committeeSignaturesList" class="d-grid"
                                        style="grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 8px;">
                                        <!-- Dynamic Checkboxes -->
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Tab 2: Excuse Details -->
                        <div class="tab-pane fade show active" id="details-pane" role="tabpanel"
                            aria-labelledby="details-tab">

                            <!-- Section 1: Personal Info -->
                            <div class="d-flex align-items-center justify-content-start gap-2 mb-3">
                                <div class="bg-primary text-white d-flex align-items-center justify-content-center rounded-2"
                                    style="width: 32px; height: 32px;">
                                    <i class="hgi hgi-stroke hgi-standard hgi-user-03"></i>
                                </div>
                                <h6 class="fw-medium mb-0">البيانات الشخصية</h6>
                            </div>

                            <div class="row g-3 mb-4">
                                <div class="col-md-6">
                                    <label class="form-label text-muted small">رقم الطالب</label>
                                    <input type="text" class="form-control bg-light" id="detailStudentId" readonly>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label text-muted small">اسم الطالب</label>
                                    <input type="text" class="form-control bg-light" id="detailStudentName" readonly>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label text-muted small">المستوى الدراسي</label>
                                    <input type="text" class="form-control bg-light" id="detailLevel" readonly>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label text-muted small">التخصص</label>
                                    <input type="text" class="form-control bg-light" id="detailMajor" readonly>
                                </div>
                            </div>

                            <!-- Section 2: Excuse Type -->
                            <div class="d-flex align-items-center justify-content-start gap-2 mb-3">
                                <div class="bg-primary text-white d-flex align-items-center justify-content-center rounded-2"
                                    style="width: 32px; height: 32px;">
                                    <i class="hgi-stroke hgi-standard hgi-help-circle"></i>
                                </div>
                                <h6 class="fw-medium mb-0">نوع العذر</h6>
                            </div>

                            <div class="row g-3 mb-4">
                                <div class="col-12">
                                    <label class="form-label text-muted small">نوع العذر</label>
                                    <input type="text" class="form-control bg-light" id="detailType" readonly>
                                </div>
                                <!-- Wrapper for conditional fields to maintain grid -->
                                <div class="col-12 mt-3">
                                    <div class="row g-3" id="detailExtraFields">
                                        <!-- Injected via JS -->
                                    </div>
                                </div>
                            </div>

                            <!-- Section 3: Absence Details -->
                            <div class="d-flex align-items-center justify-content-start gap-2 mb-3">
                                <div class="bg-primary text-white d-flex align-items-center justify-content-center rounded-2"
                                    style="width: 32px; height: 32px;">
                                    <i class="hgi-stroke hgi-standard hgi-calendar-02"></i>
                                </div>
                                <h6 class="fw-medium mb-0">تفاصيل الغياب</h6>
                            </div>

                            <div class="row g-3 mb-4">
                                <div class="col-md-6">
                                    <label class="form-label text-muted small">عدد أيام العذر</label>
                                    <input type="text" class="form-control bg-light" id="detailDuration" value="-"
                                        readonly>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label text-muted small">تاريخ العذر</label>
                                    <input type="text" class="form-control bg-light" id="detailExcuseDate" readonly>
                                </div>
                            </div>

                            <!-- Courses Table -->
                            <div class="mb-4">
                                <div class="table-responsive rounded border">
                                    <table class="table align-middle mb-0 overflow-hidden">
                                        <thead class="table-light">
                                            <tr>
                                                <th style="width: 50%;" class="fw-medium">اسم المادة</th>
                                                <th style="width: 50%;" class="fw-medium">سبب الغياب</th>
                                            </tr>
                                        </thead>
                                        <tbody id="detailCoursesTableBody">
                                            <!-- Dynamic Rows -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <!-- Additional Reason -->
                            <div class="mb-4">
                                <label class="form-label text-muted small">تفاصيل إضافية</label>
                                <textarea class="form-control bg-light" id="detailReason" rows="3" readonly></textarea>
                            </div>

                            <!-- Attachments -->
                            <div class="mb-4">
                                <div class="d-flex align-items-center justify-content-start gap-2 mb-3">
                                    <div class="bg-primary text-white d-flex align-items-center justify-content-center rounded-2"
                                        style="width: 32px; height: 32px;">
                                        <i class="hgi-stroke hgi-standard hgi-file-02 fs-6"></i>
                                    </div>
                                    <h6 class="fw-medium mb-0">المرفقات</h6>
                                </div>
                                <div id="detailFiles" class="d-flex flex-wrap gap-3"></div>
                            </div>

                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إغلاق</button>
                    <button type="button" class="btn btn-primary" id="btnSaveEmployeeDecision">حفظ</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Section (Hidden by default) -->
    <div id="settingsSection" class="container-fluid p-4 d-none">
        <div class="bg-white rounded border">
            <div class="p-3 border-bottom">
                <h5 class="mb-0">إدارة الإعدادات</h5>
            </div>

            <!-- Inner Tabs -->
            <ul class="nav nav-pills nav-fill gap-1 px-3 pt-3 border-0" id="settingsTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active fw-medium" id="account-tab" data-bs-toggle="tab"
                        data-bs-target="#account-pane" type="button">
                        <i class="hgi hgi-stroke hgi-standard hgi-user-circle-02 me-1"></i> الحساب
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link fw-medium" id="hospitals-tab" data-bs-toggle="tab"
                        data-bs-target="#hospitals-pane" type="button">
                        <i class="hgi hgi-stroke hgi-standard hgi-hospital-02 me-1"></i> المستشفيات
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link fw-medium" id="courses-tab" data-bs-toggle="tab"
                        data-bs-target="#courses-pane" type="button">
                        <i class="hgi hgi-stroke hgi-standard hgi-book-02 me-1"></i> المواد
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link fw-medium" id="reasons-tab" data-bs-toggle="tab"
                        data-bs-target="#reasons-pane" type="button">
                        <i class="hgi hgi-stroke hgi-standard hgi-note-01 me-1"></i> الأسباب
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link fw-medium" id="terms-tab" data-bs-toggle="tab" data-bs-target="#terms-pane"
                        type="button">
                        <i class="hgi hgi-stroke hgi-standard hgi-file-validation me-1"></i> الشروط
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link fw-medium" id="signatures-tab" data-bs-toggle="tab"
                        data-bs-target="#signatures-pane" type="button">
                        <i class="hgi hgi-stroke hgi-standard hgi-pencil-edit-02 me-1"></i> التواقيع
                    </button>
                </li>
            </ul>

            <!-- Tab Panes -->
            <div class="tab-content p-3">
                <!-- Account Pane -->
                <div class="tab-pane fade show active" id="account-pane">
                    <div class="mb-4">
                        <h6 class="fw-bold mb-3">تفضيلات الإشعارات</h6>
                        <div class="d-flex align-items-center justify-content-between p-3 border rounded bg-light">
                            <div>
                                <div class="fw-medium mb-1">إشعارات بالبريد الإلكتروني</div>
                                <div class="text-muted small">استلام رسالة بريد إلكتروني عند تقديم طلب عذر جديد</div>
                            </div>
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="notifyToggle" role="switch" checked
                                    style="cursor: pointer; width: 3em; height: 1.5em;">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Hospitals Pane -->
                <div class="tab-pane fade" id="hospitals-pane">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <span class="text-muted small">قائمة المستشفيات المتاحة للطلاب</span>
                        <button class="btn btn-primary btn-sm" onclick="openAddModal('hospitals', 'مستشفى')">
                            <i class="hgi hgi-stroke hgi-standard hgi-add-01 me-1"></i> إضافة مستشفى
                        </button>
                    </div>
                    <div id="hospitalsList" class="list-group"></div>
                </div>

                <!-- Courses Pane -->
                <div class="tab-pane fade" id="courses-pane">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <span class="text-muted small">قائمة المواد الدراسية</span>
                        <button class="btn btn-primary btn-sm" onclick="openAddModal('courses', 'مادة')">
                            <i class="hgi hgi-stroke hgi-standard hgi-add-01 me-1"></i> إضافة مادة
                        </button>
                    </div>
                    <div id="coursesList" class="list-group"></div>
                </div>

                <!-- Reasons Pane -->
                <div class="tab-pane fade" id="reasons-pane">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <span class="text-muted small">قائمة أسباب الأعذار</span>
                        <button class="btn btn-primary btn-sm" onclick="openAddModal('reasons', 'سبب')">
                            <i class="hgi hgi-stroke hgi-standard hgi-add-01 me-1"></i> إضافة سبب
                        </button>
                    </div>
                    <div id="reasonsList" class="list-group"></div>
                </div>

                <!-- Policy Pane -->
                <div class="tab-pane fade" id="terms-pane">
                    <span class="text-muted small d-block mb-2">نص السياسة الذي يظهر للطلاب</span>
                    <textarea id="termsTextarea" class="form-control" rows="8" dir="rtl"></textarea>

                    <!-- PDF Upload Section -->
                    <div class="mb-3">
                        <label class="form-label fw-medium">
                            <i class="hgi hgi-stroke hgi-standard hgi-file-02 me-1"></i>
                            ملف السياسة (PDF)
                        </label>
                        <div id="currentPolicyFile" class="small text-muted mb-2" style="display: none;">
                            <i class="hgi hgi-stroke hgi-standard hgi-checkmark-circle-02 text-success me-1"></i>
                            <span id="policyFileStatus">يوجد ملف سياسة محفوظ</span>
                        </div>

                        <label for="policyFileInput"
                            class="upload-box d-flex flex-column align-items-center justify-content-center p-4 rounded bg-light-subtle w-100 position-relative"
                            style="border: 2px dashed #dee2e6; cursor: pointer; height: 120px; transition: all 0.2s;">
                            <div class="default-content text-center">
                                <i class="hgi hgi-stroke hgi-standard hgi-upload-02 fs-3 text-secondary mb-2"></i>
                                <div class="text-muted small">اضغط هنا لرفع ملف PDF</div>
                                <div class="text-muted small mt-1" style="font-size: 0.75rem;">(الحد الأقصى 10MB)</div>
                            </div>
                            <div class="file-info d-none w-100 h-100 position-absolute top-0 start-0 bg-light rounded flex-column align-items-center justify-content-center"
                                style="z-index: 5;">
                                <i class="hgi hgi-stroke hgi-standard hgi-file-01 text-danger fs-1 mb-2"></i>
                                <div class="filename small text-dark fw-bold text-truncate w-75 text-center"
                                    id="policyFileName">
                                </div>
                                <button type="button"
                                    class="btn btn-danger btn-sm p-0 position-absolute top-0 end-0 m-2 rounded-circle remove-file-btn shadow-sm"
                                    style="width: 24px; height: 24px; line-height: 22px; font-size: 16px;"
                                    id="removePolicyFileBtn">&times;</button>
                            </div>
                        </label>
                        <input type="file" class="d-none" id="policyFileInput" accept="application/pdf">
                        <div class="form-text">سيتم استبدال الملف الحالي (إن وجد) عند الحفظ</div>
                    </div>

                    <button class="btn btn-primary" onclick="savePolicy()" id="savePolicyBtn">
                        <i class="hgi hgi-stroke hgi-standard hgi-checkmark-01 me-1"></i> حفظ التغييرات
                    </button>
                </div>

                <!-- Signatures Pane -->
                <div class="tab-pane fade" id="signatures-pane">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <span class="text-muted small">قائمة تواقيع أعضاء اللجنة (بحد أقصى 5)</span>
                        <button class="btn btn-primary btn-sm" onclick="openAddSignatureModal()">
                            <i class="hgi hgi-stroke hgi-standard hgi-add-01 me-1"></i> إضافة توقيع
                        </button>
                    </div>
                    <div id="signaturesList" class="row g-3">
                        <!-- Dynamic Cards -->
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>

    <!-- Add/Edit Item Modal -->
    <div class="modal fade" id="itemModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="itemModalTitle">إضافة عنصر</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="itemCategory">
                    <input type="hidden" id="itemId">
                    <div class="mb-3">
                        <label for="itemName" class="form-label">الاسم</label>
                        <input type="text" class="form-control" id="itemName" placeholder="أدخل الاسم" dir="rtl">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إلغاء</button>
                    <button type="button" class="btn btn-primary" onclick="saveItem()">
                        <i class="hgi hgi-stroke hgi-standard hgi-checkmark-01 me-1"></i> حفظ
                    </button>
                </div>
            </div>
        </div>
    </div>


    <!-- Add Signature Modal -->
    <div class="modal fade" id="addSignatureModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">إضافة توقيع عضو لجنة</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addSignatureForm">
                        <input type="hidden" id="sigId">
                        <div class="mb-3">
                            <label for="sigName" class="form-label">الاسم</label>
                            <input type="text" class="form-control" id="sigName" required placeholder="اسم عضو اللجنة">
                        </div>
                        <div class="mb-3">
                            <label for="sigPosition" class="form-label">المنصب</label>
                            <input type="text" class="form-control" id="sigPosition" required
                                placeholder="مثال: عميد الكلية">
                        </div>
                        <div class="mb-3">
                            <label for="sigImage" class="form-label">صورة التوقيع (PNG بخلفية شفافة)</label>
                            <input type="file" class="form-control" id="sigImage" accept="image/png, image/jpeg">
                        </div>
                        <div id="sigPreviewContainer" class="text-center mt-3 d-none">
                            <img id="sigPreview" src="" alt="Preview"
                                style="max-height: 80px; padding: 5px; border: 1px dashed #ccc; border-radius: 4px;">
                            <button type="button" class="btn btn-sm btn-outline-danger mt-2 d-block mx-auto"
                                onclick="removeSignatureImage()">إزالة الصورة</button>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إلغاء</button>
                    <button type="button" class="btn btn-primary" onclick="saveSignature()">
                        <span id="saveSigSpinner" class="spinner-border spinner-border-sm d-none" role="status"></span>
                        حفظ
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap 5 JS Bundle -->
    <script src="lib/popper/popper.min.js"></script>
    <script src="lib/bootstrap/js/bootstrap.min.js"></script>
    <script src="lib/sweetalert2/sweetalert2.all.min.js"></script>

    <!-- PDF-Lib for signature overlay -->
    <script src="lib/pdf-lib/pdf-lib.min.js"></script>
    <!-- Tempus Dominus JavaScript (UMD) -->
    <script src="lib/tempus-dominus/tempus-dominus.min.js"></script>
    <script src="js/config.js" defer></script>
    <script src="js/admin-portal.js" defer></script>
</body>

</html>